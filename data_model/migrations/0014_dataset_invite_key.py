# Generated by Django 2.0.4 on 2018-07-15 13:12

from django.db import migrations, models
from django.db.models import Q

from data_model.model_utils import generate_invite_key


def generate_invite_keys(apps, schema_editor):
    dataset_model = apps.get_model('data_model', 'Dataset')
    for dataset in dataset_model.objects.filter(Q(invite_key__isnull=True) | Q(invite_key='')):
        dataset.invite_key = generate_invite_key(dataset)
        dataset.save()


class Migration(migrations.Migration):
    dependencies = [
        ('data_model', '0013_auto_20180626_2002'),
    ]

    operations = [
        migrations.AddField(
            model_name='dataset',
            name='invite_key',
            field=models.CharField(max_length=128, null=True),
        ), migrations.RunPython(
            generate_invite_keys
        )
    ]
